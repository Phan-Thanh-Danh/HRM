@model IEnumerable<HRM.ViewModels.HR.DepartmentVM>

@{
      ViewData["Title"] = "Sơ đồ tổ chức";
}

<div class="container mt-4">
      <div class="card shadow-sm border-0">
            <div class="card-header bg-info text-dark d-flex justify-content-between align-items-center py-3">
                  <h4 class="mb-0"><i class="bi bi-diagram-3 me-2"></i>Sơ đồ tổ chức</h4>
                  <a asp-action="Index" class="btn btn-outline-dark btn-sm">
                        <i class="bi bi-list-ul me-1"></i> Quay lại danh sách
                  </a>
            </div>
            <div class="card-body p-5">
                  <div class="org-chart-container">
                        @if (!Model.Any())
                        {
                              <div class="alert alert-light text-center border">
                                    <i class="bi bi-info-circle me-2"></i>Chưa có dữ liệu phòng ban để hiển thị sơ đồ.
                              </div>
                        }
                        else
                        {
                              <ul class="org-tree">
                                    @foreach (var dept in Model.Where(d => d.ParentId == null))
                                    {
                                          @await Html.PartialAsync("_DepartmentNode", new
                              KeyValuePair<HRM.ViewModels.HR.DepartmentVM,
                              IEnumerable<HRM.ViewModels.HR.DepartmentVM>>(dept, Model))
                                    }
                              </ul>
                        }
                  </div>
            </div>
      </div>
</div>

<style>
      .org-tree,
      .org-tree ul {
            list-style-type: none;
            margin: 0;
            padding: 0;
            position: relative;
      }

      .org-tree ul {
            margin-left: 40px;
            border-left: 2px solid #dee2e6;
            padding-top: 10px;
            padding-bottom: 10px;
      }

      .org-tree li {
            margin: 0;
            padding: 10px 0 10px 20px;
            position: relative;
      }

      .org-tree li::before {
            content: "";
            position: absolute;
            top: 25px;
            left: 0;
            width: 20px;
            height: 2px;
            background-color: #dee2e6;
      }

      .dept-card {
            background: #fff;
            border: 1px solid #e3e6f0;
            border-left: 4px solid #36b9cc;
            border-radius: 6px;
            padding: 12px 20px;
            display: inline-block;
            min-width: 200px;
            box-shadow: 0 .125rem .25rem rgba(0, 0, 0, .075);
            transition: transform 0.2s;
      }

      .dept-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 .5rem 1rem rgba(0, 0, 0, .1);
            border-color: #36b9cc;
      }

      .dept-name {
            font-weight: bold;
            color: #4e73df;
            margin-bottom: 4px;
            display: block;
      }

      .dept-manager {
            font-size: 0.85rem;
            color: #6e707e;
            display: block;
      }

      .dept-count {
            font-size: 0.75rem;
            background-color: #f8f9fc;
            padding: 2px 8px;
            border-radius: 10px;
            color: #858796;
            margin-top: 5px;
            display: inline-block;
      }
</style>